import socket
import time

# Dirección IP del robot UR
HOST = "10.10.73.236"

# Puerto del servidor en el robot
PORT = 30002

# Scripts para abrir y cerrar la pinza
Abrir_pinza = 'pinza40UR3.py'
Cerrar_pinza = 'pinza10UR3.py'

# Función para enviar una trayectoria en espacio de configuraciones a la controladora del robot
def send_joint_path(path, sock):
    for joint_config in path:
        print(joint_config)
        sock.send(f"movej({joint_config}, a=0.5, v=0.5)".encode() + "\n".encode())
        time.sleep(1)

# Conexión via socket a la controladora del robot
sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
sock.connect((HOST, PORT))

# Trayectoria -- configuraciones (variables ctoria del robot real con la trayectoria del robot simulado en Kautham.# 
# Comenta si observas alguna diferencia y razónaloarticulares, en radianes)
path1 = [
    [2.2254700660705566, -0.9299110174179077, 0.6956869959831238, -1.3182499408721924, -1.515470027923584, -0.9171689748764038],
    [2.281090021133423, -0.9395390152931213, 0.7164279818534851, -1.3485000133514404, -1.5062999725341797, -0.8575379848480225],
    [2.336699962615967, -0.949167013168335, 0.73716801404953, -1.378749966621399, -1.4971400499343872, -0.7979059815406799],
    [2.392319917678833, -0.9587950110435486, 0.7579089999198914, -1.409000039100647, -1.4879800081253052, -0.7382739782333374],
    [2.4479401111602783, -0.9684230089187622, 0.7786499857902527, -1.4392600059509277, -1.4788099527359009, -0.678642988204956],
    [2.5035600662231445, -0.9780510067939758, 0.799390971660614, -1.4695099592208862, -1.4696500301361084, -0.6190109848976135],
    [2.5591800212860107, -0.9876790046691895, 0.8201320171356201, -1.4997600317001343, -1.4604899883270264, -0.559378981590271]
] # Transit

path2 = [
    [2.5591800212860107, -0.9876790046691895, 0.8201320171356201, -1.4997600317001343, -1.4604899883270264, -0.559378981590271],
    [2.5591800212860107, -0.9876220226287842, 0.9306110143661499, -1.6102999448776245, -1.460610032081604, -0.5590299963951111],
    [2.5591800212860107, -0.9875659942626953, 1.0410900115966797, -1.720829963684082, -1.4607199430465698, -0.55867999792099],
    [2.5591800212860107, -0.98750901222229, 1.1515699625015259, -1.8313699960708618, -1.4608399868011475, -0.5583299994468689]
] # Transit

path3 = [
    [2.5591800212860107, -0.98750901222229, 1.1515699625015259, -1.8313699960708618, -1.4608399868011475, -0.5583299994468689],
    [2.5591800212860107, -0.987542986869812, 1.085279941558838, -1.7650500535964966, -1.4607700109481812, -0.5585399866104126],
    [2.5591800212860107, -0.9875770211219788, 1.0189900398254395, -1.6987299919128418, -1.4607000350952148, -0.5587499737739563],
    [2.5591800212860107, -0.9876109957695007, 0.9527069926261902, -1.6324000358581543, -1.4606300592422485, -0.5589600205421448],
    [2.5591800212860107, -0.9876449704170227, 0.8864189982414246, -1.5660799741744995, -1.4605599641799927, -0.5591689944267273],
    [2.5591800212860107, -0.9876790046691895, 0.8201320171356201, -1.4997600317001343, -1.4604899883270264, -0.559378981590271],
    [2.5591800212860107, -0.9876790046691895, 0.8201320171356201, -1.4997600317001343, -1.4604899883270264, -0.559378981590271],
    [2.5274100303649902, -1.078179955482483, 0.9324439764022827, -1.5026400089263916, -1.462839961051941, -0.5842480063438416],
    [2.4956400394439697, -1.1686700582504272, 1.04475998878479, -1.505519986152649, -1.4651999473571777, -0.6091169714927673],
    [2.4956400394439697, -1.1686700582504272, 1.04475998878479, -1.505519986152649, -1.4651999473571777, -0.6091169714927673],
    [2.4956700801849365, -1.165179967880249, 1.1019699573516846, -1.5662599802017212, -1.4652600288391113, -0.6088849902153015],
    [2.495699882507324, -1.1616899967193604, 1.159190058708191, -1.6269999742507935, -1.4653199911117554, -0.6086519956588745],
    [2.495729923248291, -1.1582000255584717, 1.2164100408554077, -1.6877299547195435, -1.4653799533843994, -0.6084200143814087],
    [2.495759963989258, -1.154710054397583, 1.2736300230026245, -1.7484699487686157, -1.465440034866333, -0.6081870198249817],
    [2.4957900047302246, -1.1512199640274048, 1.330839991569519, -1.809209942817688, -1.4654899835586548, -0.6079549789428711]
] # Transfer

path4 = [
    [2.4958200454711914, -1.1477299928665161, 1.3880599737167358, -1.8699500560760498, -1.4655499458312988, -0.6077219843864441],
    [2.495759963989258, -1.154710054397583, 1.2736300230026245, -1.7484699487686157, -1.465440034866333, -0.6081870198249817],
    [2.495699882507324, -1.1616899967193604, 1.159190058708191, -1.6269999742507935, -1.4653199911117554, -0.6086519956588745],
    [2.4956400394439697, -1.1686700582504272, 1.04475998878479, -1.505519986152649, -1.4651999473571777, -0.6091169714927673]
] # Transit

path5 = [
    [2.4956400394439697, -1.1686700582504272, 1.04475998878479, -1.505519986152649, -1.4651999473571777, -0.6091169714927673],
    [2.4698100090026855, -1.1110800504684448, 0.9949550032615662, -1.5488100051879883, -1.4492000341415405, -0.6415799856185913],
    [2.4439799785614014, -1.0534800291061401, 0.9451550245285034, -1.5920900106430054, -1.433210015296936, -0.6740429997444153],
    [2.418149948120117, -0.9958850145339966, 0.8953539729118347, -1.6353700160980225, -1.4172099828720093, -0.7065060138702393]
] # Transit

path6 = [
    [2.418149948120117, -0.9958850145339966, 0.8953539729118347, -1.6353700160980225, -1.4172099828720093, -0.7065060138702393],
    [2.418149948120117, -0.990822970867157, 0.9887869954109192, -1.733929991722107, -1.417330026626587, -0.7061589956283569],
    [2.418149948120117, -0.9857609868049622, 1.0822199583053589, -1.8324799537658691, -1.4174400568008423, -0.7058110237121582],
    [2.418149948120117, -0.9806979894638062, 1.1756500005722046, -1.931030035018921, -1.4175599813461304, -0.7054640054702759]
] # Transit

path7 = [
    [2.418149948120117, -0.9806979894638062, 1.1756500005722046, -1.931030035018921, -1.4175599813461304, -0.7054640054702759],
    [2.418149948120117, -0.983735978603363, 1.1195900440216064, -1.871899962425232, -1.417490005493164, -0.705672025680542],
    [2.418149948120117, -0.9867730140686035, 1.0635299682617188, -1.8127700090408325, -1.4174200296401978, -0.7058809995651245],
    [2.418149948120117, -0.9898099899291992, 1.0074700117111206, -1.753640055656433, -1.4173500537872314, -0.7060890197753906],
    [2.418149948120117, -0.9928479790687561, 0.9514139890670776, -1.6945099830627441, -1.4172799587249756, -0.7062979936599731],
    [2.418149948120117, -0.9958850145339966, 0.8953539729118347, -1.6353700160980225, -1.4172099828720093, -0.7065060138702393],
    [2.418149948120117, -0.9958850145339966, 0.8953539729118347, -1.6353700160980225, -1.4172099828720093, -0.7065060138702393],
    [2.3539199829101562, -0.9738940000534058, 0.8287979960441589, -1.529670000076294, -1.4499599933624268, -0.776727020740509],
    [2.2897000312805176, -0.9519029855728149, 0.7622429728507996, -1.4239599704742432, -1.4827100038528442, -0.8469480276107788],
    [2.2254700660705566, -0.9299110174179077, 0.6956869959831238, -1.3182499408721924, -1.515470027923584, -0.9171689748764038],
    [2.2254700660705566, -0.9299110174179077, 0.6956869959831238, -1.3182499408721924, -1.515470027923584, -0.9171689748764038],
    [2.2254700660705566, -0.9349030256271362, 0.7645580172538757, -1.3821300268173218, -1.515470027923584, -0.9169260263442993],
    [2.2254700660705566, -0.9398940205574036, 0.8334289789199829, -1.4460099935531616, -1.515470027923584, -0.9166820049285889],
    [2.2254700660705566, -0.9448860287666321, 0.902301013469696, -1.5098899602890015, -1.515470027923584, -0.9164379835128784],
    [2.2254700660705566, -0.9498770236968994, 0.9711719751358032, -1.5737600326538086, -1.515470027923584, -0.9161940217018127]
] # Transfer

path8 = [
    [2.2254700660705566, -0.9548680186271667, 1.0400400161743164, -1.6376399993896484, -1.515470027923584, -0.9159500002861023],
    [2.2254700660705566, -0.9465489983558655, 0.9252579808235168, -1.5311800241470337, -1.515470027923584, -0.9163569808006287],
    [2.2254700660705566, -0.9382299780845642, 0.8104720115661621, -1.4247100353240967, -1.515470027923584, -0.9167630076408386],
    [2.2254700660705566, -0.9299110174179077, 0.6956869959831238, -1.3182499408721924, -1.515470027923584, -0.9171689748764038]
] # Transit

path9 = [
    [2.2254700660705566, -0.9299110174179077, 0.6956869959831238, -1.3182499408721924, -1.515470027923584, -0.9171689748764038],
    [2.25393009185791, -0.9754350185394287, 0.7652239799499512, -1.3507699966430664, -1.5120899677276611, -0.8873100280761719],
    [2.2823901176452637, -1.0209599733352661, 0.8347610235214233, -1.3832900524139404, -1.50872004032135, -0.857450008392334],
    [2.3108599185943604, -1.066480040550232, 0.9042980074882507, -1.415809988975525, -1.5053399801254272, -0.8275899887084961],
    [2.339319944381714, -1.1120100021362305, 0.9738349914550781, -1.448330044746399, -1.5019700527191162, -0.797730028629303],
    [2.3677899837493896, -1.1575299501419067, 1.043370008468628, -1.4808599948883057, -1.4986000061035156, -0.7678700089454651],
    [2.396250009536743, -1.2030500173568726, 1.1129100322723389, -1.5133800506591797, -1.4952199459075928, -0.7380099892616272],
    [2.4247100353240967, -1.248579978942871, 1.1824500560760498, -1.5458999872207642, -1.4918500185012817, -0.7081509828567505],
    [2.4531800746917725, -1.294100046157837, 1.251979947090149, -1.5784200429916382, -1.4884699583053589, -0.6782910227775574],
    [2.481640100479126, -1.3396300077438354, 1.3215199708938599, -1.6109399795532227, -1.4851000308990479, -0.6484310030937195],
    [2.5101099014282227, -1.3851499557495117, 1.3910599946975708, -1.6434600353240967, -1.4817299842834473, -0.6185709834098816],
    [2.538569927215576, -1.4306700229644775, 1.4605900049209595, -1.6759799718856812, -1.478350043296814, -0.5887110233306885],
    [2.5670299530029297, -1.476199984550476, 1.5301300287246704, -1.7085000276565552, -1.4749799966812134, -0.5588510036468506]
] # Transit


# Se envia la trayectoria a la controladora del robot
send_joint_path(path1, sock) # Transit
send_joint_path(path2, sock) # Transit

# Enviar archivo script cerrar pinza
with open(Cerrar_pinza, 'rb') as f: sock.sendall(f.read())
time.sleep(1)

# Se envia la trayectoria a la controladora del robot
send_joint_path(path3, sock) # Transfer

# Enviar archivo script abrir pinza
with open(Abrir_pinza, 'rb') as f: sock.sendall(f.read())
time.sleep(1)

# Se envia la trayectoria a la controladora del robot
send_joint_path(path4, sock) # Transit
send_joint_path(path5, sock) # Transit
send_joint_path(path6, sock) # Transit

# Enviar archivo script cerrar pinza
with open(Cerrar_pinza, 'rb') as f: sock.sendall(f.read())
time.sleep(1)

# Se envia la trayectoria a la controladora del robot
send_joint_path(path7, sock) # Transfer

# Enviar archivo script abrir pinza
with open(Abrir_pinza, 'rb') as f: sock.sendall(f.read())
time.sleep(1)

# Se envia la trayectoria a la controladora del robot
send_joint_path(path8, sock) # Transit
send_joint_path(path9, sock) # Transit

# Mensaje que se imprime cuando se finaliza la ejecución
# de la trayectoria
print("Trayectoria finalizada")

data = sock.recv(1024)

# Se cierra la conexión
sock.close()
